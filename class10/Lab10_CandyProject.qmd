---
title: "Lab 10: Halloween Candy Mini-Project"
author: "Kira"
format: gfm
---

## 1. Importing candy data

```{r}
candy_data <- "candy-data.csv"
candy = read.csv(candy_data, row.names=1)
head(candy)
```

>Q1. How many different candy types are in this dataset?

```{r}
nrow(candy)
```

There are 85 different candy types in this dataset. 

>Q2. How many fruity candy types are in the dataset?

```{r}
table(candy[,2])
```

There are 38 fruity candy types in this dataset.

## 2. What is your favorate candy?

>Q3. What is your favorite candy in the dataset and what is its winpercent value?

```{r}
candy["Haribo Sour Bears",]$winpercent
```

My favorite candy in the dataset is Haribo Sour Bears and its winpercent value is 51.41%. 

>Q4. What is the winpercent value for “Kit Kat”?

```{r}
candy["Kit Kat",]$winpercent
```

The winpercent value for Kit Kat is 76.76%.

>Q5. What is the winpercent value for “Tootsie Roll Snack Bars”?

```{r}
candy["Tootsie Roll Snack Bars",]$winpercent
```

The winpercent value for Tootsie Roll Snack Bars is 49.65%.

```{r}
library("skimr")
skim(candy)
```

>Q6. Is there any variable/column that looks to be on a different scale to the majority of the other columns in the dataset?

The winpercent variable appears to be on a different scale since its values are as high as (84.18) while all other variables have a maximum value of 1.

>Q7. What do you think a zero and one represent for the candy$chocolate column?

I think the 0 and 1 represent whether that candy has that characteristic or not (i.e if a candy contains chocolate, it would be assigned a 1 and would be assigned a 0 if it did not)

>Q8. Plot a histogram of winpercent values

```{r}
hist(candy$winpercent)
```

>Q9. Is the distribution of winpercent values symmetrical?

The distribution of winpercent values is not exactly symmetrical and is shifted slightly to the left (i.e the highest frequency occurs at ~45% rather than ~50%).

>Q10. Is the center of the distribution above or below 50%?

The center of the distribution is slightly below 50%.

>Q11. On average is chocolate candy higher or lower ranked than fruit candy?

```{r}
# Want to find what is the average of the winpercent values of candies that have a "1" value for chocolate variable
mean_chocolate <- mean(candy$winpercent[as.logical(candy$chocolate)])
mean_chocolate
```

```{r}
mean_fruity <- mean(candy$winpercent[as.logical(candy$fruity)])
mean_fruity
```

On average, chocolate candy is higher ranked that fruity candy. 

>Q12. Is this difference statistically significant?

We can determine if this different is statistically significant by performing a t-test.

```{r}
t.test(candy$winpercent[as.logical(candy$chocolate)],candy$winpercent[as.logical(candy$fruity)])
```

The difference is statistically significant because the p-value is less than 0.05.

## 3. Overall Candy Rankings

>Q13. What are the five least liked candy types in this set?

```{r}
head(candy[order(candy$winpercent),], n=5)
```

The five least liked candies in this dataset are Nik L Nip, Boston Baked Beans, Chiclets, Super Bubble, and Jawbusters.

>Q14. What are the top 5 all time favorite candy types out of this set?

```{r}
tail(candy[order(candy$winpercent),], n=5)
```

The five most liked candies in this dataset are Snickers, Kit Kat, Twix, Reese's Miniatures, and Reese's Peanut Butter cup.

>Q15. Make a first barplot of candy ranking based on winpercent values.

```{r}
library(ggplot2)

ggplot(candy) + 
  aes(winpercent, rownames(candy)) +
  geom_col()
```

>Q16. This is quite ugly, use the reorder() function to get the bars sorted by winpercent?

```{r}
ggplot(candy) + aes(winpercent, reorder(rownames(candy),winpercent)) + geom_col()
```

Let’s setup a color vector (that signifies candy type) that we can then use for some future plots.

```{r}
my_cols=rep("black", nrow(candy))
my_cols[as.logical(candy$chocolate)] = "chocolate"
my_cols[as.logical(candy$bar)] = "brown"
my_cols[as.logical(candy$fruity)] = "pink"
```

Now let’s try our barplot with these colors:

```{r}
ggplot(candy) + 
  aes(winpercent, reorder(rownames(candy),winpercent)) +
  geom_col(fill=my_cols) 
```

>Q17. What is the worst ranked chocolate candy?

The worst ranked chocolate candy is Sixlets.

> Q18. What is the best ranked fruity candy

The best ranked fruity candy is Starburst.

## 4. Taking a look at pricepercent

What about value for money? What is the the best candy for the least money?

```{r}
library(ggrepel)

# How about a plot of price vs win
ggplot(candy) +
  aes(winpercent, pricepercent, label=rownames(candy)) +
  geom_point(col=my_cols) + 
  geom_text_repel(col=my_cols, size=3.3, max.overlaps = 5)
```

>Q19. Which candy type is the highest ranked in terms of winpercent for the least money - i.e. offers the most bang for your buck?

Reese's Miniatures have the highest ranked winpercent for the least price.

>Q20. What are the top 5 most expensive candy types in the dataset and of these which is the least popular?

```{r}
ord <- order(candy$pricepercent, decreasing = TRUE)
head( candy[ord,c(11,12)], n=5 )
```

The top five most expensive candies are Nik L Nip, Neslte Smarties, Ring pop, Hershey's Krackel, and Hershey's Milk Chocolate. The least popular of these is Nik L Nip. 

## 5. Exploring the correlation structure

Now that we’ve explored the dataset a little, we’ll see how the variables interact with one another. We’ll use correlation and view the results with the corrplot package to plot a correlation matrix.

```{r}
library(corrplot)
```

```{r}
cij <- cor(candy)
corrplot(cij)
```

>Q22. Examining this plot what two variables are anti-correlated (i.e. have minus values)?

Fruity and chocolate variables are anti-correlated.

>Q23. Similarly, what two variables are most positively correlated?

Chocolate and winpercent are the most positively correlated.

## 6. Principal Component Analysis

Now, we can apply PCA to our candy dataset.

```{r}
pca <- prcomp(candy, scale=TRUE)
summary(pca)
```

Now, we can plot PC1 vs. PC2:

```{r}
plot(pca$x[,1:2])
```

We can change the plotting character and add some color:

```{r}
plot(pca$x[,1:2], col=my_cols, pch=16)
```

We can make a much nicer plot with the ggplot2 package but we will first need to make a new `data.frame()` with our PCA results.

```{r}
# Make a new data-frame with our PCA results and candy data
my_data <- cbind(candy, pca$x[,1:3])
```

```{r}
p <- ggplot(my_data) + 
        aes(x=PC1, y=PC2, 
            size=winpercent/100,  
            text=rownames(my_data),
            label=rownames(my_data)) +
        geom_point(col=my_cols)

p
```

We can also use the `ggrepel()` package to label the plot with the names of the candies in the dataset.

```{r}
library(ggrepel)

p + geom_text_repel(size=3.3, col=my_cols, max.overlaps = 7)  + 
  theme(legend.position = "none") +
  labs(title="Halloween Candy PCA Space",
       subtitle="Colored by type: chocolate bar (dark brown), chocolate other (light brown), fruity (red), other (black)",
       caption="Data from 538")
```

It is also helpful to use the `plotly()` function to generate an interactive plot that you can mouse over to see labels:

```{r}
library(plotly)
```

```{r}
ggplotly(p)
```

We can wrap up by looking at the loadings of our PCA.

```{r}
par(mar=c(8,4,2,2))
barplot(pca$rotation[,1], las=2, ylab="PC1 Contribution")
```

>Q24. What original variables are picked up strongly by PC1 in the positive direction? Do these make sense to you?

The variables fruity, hard, and pluribus are associated positively with PC1.This signifies that these variables have a strong effect on PC1 and this makes sense when considering the types of candies that the variables represent.

